<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Â¡Gracias por tu confirmaciÃ³n! â€” Oihane & Ander</title>
  <meta name="description" content="PÃ¡gina de agradecimiento por confirmar asistencia a la boda de Oihane y Ander.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <main>
    <div class="thank-you-container">
      <h1>Â¡Muchas gracias por tu confirmaciÃ³n! ðŸŽ‰</h1>
      <p>Nos hace muchÃ­sima ilusiÃ³n que compartas este dÃ­a tan especial con nosotros.</p>
      <p>Un Ãºltimo favorcito para ayudarnos a recordar cada momento:</p>
      <p>
        **Â¿Nos podrÃ­as subir algunas fotos de los asistentes a la boda donde se les vea bien?**
        <br>Nos ayudarÃ¡ a identificar a todos nuestros seres queridos. Â¡Sube tantas como quieras!
      </p>

      <form name="guest-photos-2026" id="photos-form" method="POST" action="/.netlify/functions/submit-form" enctype="multipart/form-data">
        <div id="file-upload-inputs" class="file-input-wrapper">
          
        </div>
        <p class="photo-upload-hint">Puedes aÃ±adir mÃ¡s archivos haciendo clic de nuevo.</p>
        <button type="button" class="btn-outline" id="add-photo-btn">AÃ±adir otra foto</button>

        <div id="photo-previews" class="preview-container">
          
        </div>

        <button type="submit" class="btn-primary">Enviar fotos</button>
      </form>

      <p style="margin-top: 2rem;">Â¿Necesitas volver al inicio? <a href="/" class="btn-outline" style="text-decoration: none;">Volver a la web</a></p>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const fileUploadInputs = document.getElementById('file-upload-inputs');
      const addPhotoBtn = document.getElementById('add-photo-btn');
      const photoPreviews = document.getElementById('photo-previews');
      let fileCount = 0;
      let filesToUpload = [];

      function addFileInput() {
        fileCount++;
        const uniqueId = `photo_${fileCount}`;
        const inputContainer = document.createElement('div');
        inputContainer.className = 'custom-file-upload-container';
        
        const label = document.createElement('label');
        label.className = 'custom-file-upload';
        label.htmlFor = uniqueId;
        label.innerHTML = `Seleccionar foto ${fileCount}`;

        const input = document.createElement('input');
        input.type = 'file';
        input.id = uniqueId;
        input.name = `guest_photo_${fileCount}`;
        input.accept = 'image/*';
        input.multiple = false;

        input.addEventListener('change', (event) => {
          if (event.target.files.length > 0) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = (e) => {
              const previewItem = document.createElement('div');
              previewItem.className = 'preview-item';
              previewItem.innerHTML = `<img src="${e.target.result}" alt="Foto ${uniqueId}">
                                       <button type="button" class="remove-photo-btn" data-id="${uniqueId}">X</button>`;
              photoPreviews.appendChild(previewItem);
              
              filesToUpload.push({ id: uniqueId, file: file, inputElement: input });

              label.textContent = file.name;
              label.classList.add('file-selected');
            };
            reader.readAsDataURL(file);
          }
        });

        fileUploadInputs.appendChild(input);
        fileUploadInputs.appendChild(label);
      }

      addFileInput();

      addPhotoBtn.addEventListener('click', addFileInput);

      photoPreviews.addEventListener('click', (event) => {
        if (event.target.classList.contains('remove-photo-btn')) {
          const uniqueIdToRemove = event.target.dataset.id;
          event.target.closest('.preview-item').remove();

          const indexToRemove = filesToUpload.findIndex(f => f.id === uniqueIdToRemove);
          if (indexToRemove !== -1) {
            const removedFile = filesToUpload.splice(indexToRemove, 1)[0];
            if (removedFile.inputElement) {
                removedFile.inputElement.value = '';
                const labelForInput = document.querySelector(`label[for="${removedFile.inputElement.id}"]`);
                if(labelForInput) {
                    labelForInput.textContent = `Seleccionar foto ${removedFile.inputElement.id.split('_')[1]}`;
                    labelForInput.classList.remove('file-selected');
                }
            }
          }
        }
      });
      
      const photosForm = document.getElementById('photos-form');
      photosForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const formData = new FormData(photosForm);
          
          try {
              const response = await fetch(photosForm.action, {
                  method: 'POST',
                  body: formData,
              });

              if (response.ok) {
                  window.location.href = '/gracias-fotos.html';
              } else {
                  console.error('Error en el servidor:', await response.text());
                  alert('Error al subir las fotos. Por favor, intÃ©ntalo de nuevo.');
              }
          } catch (error) {
              console.error('Error de red:', error);
              alert('Error al subir las fotos. Por favor, intÃ©ntalo de nuevo.');
          }
      });
    });
  </script>
</body>
</html>