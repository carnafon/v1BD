<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Â¡Gracias por tu confirmaciÃ³n! â€” Oihane & Ander</title>
  <meta name="description" content="PÃ¡gina de agradecimiento por confirmar asistencia a la boda de Oihane y Ander.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <main>
    <div class="thank-you-container">
      <h1>Â¡Muchas gracias por tu confirmaciÃ³n! ðŸŽ‰</h1>
      <p>Nos hace muchÃ­sima ilusiÃ³n que compartas este dÃ­a tan especial con nosotros.</p>
      <p>Un Ãºltimo favorcito para ayudarnos a recordar cada momento:</p>
      <p>
        **Â¿Nos podrÃ­as subir algunas fotos de los asistentes a la boda donde se les vea bien?**
        <br>Nos ayudarÃ¡ a identificar a todos nuestros seres queridos. Â¡Sube tantas como quieras!
      </p>

      <form name="guest-photos-2026" id="photos-form" method="POST" action="/.netlify/functions/submit-form">
        <div class="file-input-wrapper">
          <input type="file" name="file1" id="file1" accept="image/*" multiple>
          <label for="file1" class="custom-file-upload">Seleccionar fotos</label>
        </div>
        <div class="preview-container"></div>
        <button type="submit" class="btn-primary" id="submit-photos-btn" style="margin-top: 1rem;">
          Subir fotos
        </button>
      </form>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const fileInput = document.getElementById('file1');
      const previewContainer = document.querySelector('.preview-container');
      const filesToUpload = [];

      fileInput.addEventListener('change', (e) => {
        const files = e.target.files;
        if (files.length > 0) {
          for (const file of files) {
            const reader = new FileReader();
            reader.onload = (event) => {
              const previewItem = document.createElement('div');
              previewItem.classList.add('preview-item');
              
              const img = document.createElement('img');
              img.src = event.target.result;
              img.alt = file.name;

              const removeBtn = document.createElement('button');
              removeBtn.textContent = 'x';
              removeBtn.classList.add('remove-btn');
              removeBtn.addEventListener('click', () => {
                previewItem.remove();
                const indexToRemove = filesToUpload.findIndex(f => f.file === file);
                if (indexToRemove !== -1) {
                    filesToUpload.splice(indexToRemove, 1);
                }
              });

              previewItem.appendChild(img);
              previewItem.appendChild(removeBtn);
              previewContainer.appendChild(previewItem);
            };
            reader.readAsDataURL(file);
            filesToUpload.push({ file: file, name: file.name });
          }
        }
      });
      
      const photosForm = document.getElementById('photos-form');
      photosForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const rsvpId = localStorage.getItem('rsvpId');
          if (!rsvpId) {
            console.error('No se encontrÃ³ el ID de RSVP en localStorage.');
            alert('No se pudo asociar las fotos. Por favor, vuelve a la pÃ¡gina principal.');
            return;
          }

          const formData = new FormData();
          filesToUpload.forEach(f => {
              formData.append('photos', f.file, f.name);
          });
          formData.append('rsvpId', rsvpId);
          
          try {
              const response = await fetch(photosForm.action, {
                  method: 'POST',
                  body: formData,
              });

              if (response.ok) {
                  window.location.href = '/gracias-fotos.html';
              } else {
                  console.error('Error en el servidor:', await response.text());
                  alert('Error al subir las fotos. Por favor, intÃ©ntalo de nuevo.');
              }
          } catch (error) {
              console.error('Error de red:', error);
              alert('Error al subir las fotos. Por favor, intÃ©ntalo de nuevo.');
          }
      });
    });
  </script>
</body>
</html>
